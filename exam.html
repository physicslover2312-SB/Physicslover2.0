<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MCQ Exam — Class 7-12</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+Bengali:wght@700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#e8f6ff; --bg2:#f7fbff; --card:#ffffff;
    --accent:#0b63ff; --accent2:#00d1ff; --muted:#6b7280;
    --success:#0f766e;
    --danger:#d33;
  }
  *{box-sizing:border-box}
  body{
    margin:0;font-family:Inter, 'Noto Sans Bengali', sans-serif;
    background: linear-gradient(180deg,var(--bg1),var(--bg2));
    color:#0f172a; -webkit-font-smoothing:antialiased;
  }

  /* page container */
  .wrap{
    max-width:920px;margin:20px auto;padding:18px;
  }

  /* header card */
  .header{
    display:flex;gap:12px;align-items:center;justify-content:space-between;
    background:linear-gradient(90deg,rgba(11,99,255,0.06),rgba(0,209,255,0.03));
    border-radius:12px;padding:14px 18px;box-shadow:0 6px 24px rgba(11,99,255,0.06);
  }
  .brand{display:flex;gap:12px;align-items:center}
  .logo{
    width:52px;height:52px;border-radius:10px;
    background:linear-gradient(135deg,var(--accent),var(--accent2));
    display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:20px;
    box-shadow:0 6px 18px rgba(11,99,255,0.18);
  }
  .brand h1{margin:0;font-size:1.06rem}
  .brand p{margin:0;color:var(--muted);font-size:0.86rem}

  /* panel layout */
  .grid{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:16px}
  @media (max-width:880px){ .grid{grid-template-columns:1fr} }

  /* left: exam area */
  .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 8px 30px rgba(15,23,42,0.04);}
  .meta{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:12px}
  .meta .left{font-weight:600;color:var(--muted)}
  .meta .right{font-weight:700;color:var(--accent)}

  /* timer */
  .timer{
    display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border-radius:999px;
    background:linear-gradient(90deg,rgba(11,99,255,0.06),transparent);font-weight:700;color:var(--accent);
    box-shadow:0 6px 18px rgba(11,99,255,0.05);
  }

  /* question card */
  .q-card{margin-top:8px;border-radius:12px;padding:16px;border:1px solid #eef6ff;background:linear-gradient(180deg,#ffffff,#fbfdff)}
  .q-top{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:10px}
  .q-no{font-weight:700;color:#223}
  .progress{
    height:8px;background:#eef3ff;border-radius:999px;overflow:hidden;width:140px;
  }
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));width:10%}

  .q-text{font-size:1.07rem;margin:8px 0 14px;color:#0b2540;font-weight:600}
  .opts{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media (max-width:520px){ .opts{grid-template-columns:1fr} }

  .opt{
    padding:12px;border-radius:10px;background:#f6feff;border:1px solid #e6fbff;cursor:pointer;font-weight:600;
    transition:all .16s ease;box-shadow:0 6px 18px rgba(0,0,0,0.02);
  }
  .opt:hover{transform:translateY(-4px)}
  .opt.selected{background:linear-gradient(90deg,#dffbf7,#baf5e9);border:1px solid #7be3c9;color:var(--success)}
  .opt.wrong{background:#fff0f0;border:1px solid #ffd6d6;color:var(--danger)}

  .navs{display:flex;justify-content:space-between;gap:10px;margin-top:12px;align-items:center}
  .btn{padding:10px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer}
  .btn.ghost{background:transparent;border:1px solid #e6eefb;color:var(--accent)}
  .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;box-shadow:0 8px 30px rgba(11,99,255,0.12)}
  .btn.skip{background:#fff7ed;border:1px solid #ffecd1;color:#b45f00}

  /* right: control panel */
  .side-title{font-weight:700;margin-bottom:8px}
  .controls{display:flex;flex-direction:column;gap:12px}
  .input{
    display:flex;gap:8px;align-items:center;
  }
  .input input[type="text"]{flex:1;padding:10px;border-radius:10px;border:1px solid #e6eefb;background:#fbfdff;font-weight:600}
  .select-class{padding:10px;border-radius:10px;border:1px solid #e6eefb;background:#fff;font-weight:700;cursor:pointer}

  .summary{display:flex;flex-direction:column;gap:8px}
  .stat{display:flex;justify-content:space-between;padding:10px;border-radius:8px;background:#fbfffe;border:1px solid #e9fbf8}
  .final{margin-top:10px;padding:12px;border-radius:10px;background:linear-gradient(90deg,#f6fbff,#f0fff9);font-weight:700}

  /* result modal */
  .modal {
    position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(3,7,18,0.5);z-index:9999;
  }
  .modal .mcard{width:90%;max-width:520px;background:#fff;padding:18px;border-radius:12px;box-shadow:0 24px 60px rgba(2,6,23,0.35)}
  .mcard h2{margin:0 0 6px}
  .mcard p{margin:6px 0;color:var(--muted)}

  /* small helpers */
  .muted{color:var(--muted);font-weight:600}
  .center{text-align:center}
  footer{margin-top:18px;text-align:center;color:var(--muted);font-size:0.86rem}
</style>
</head>
<body>
  <div class="wrap">

    <div class="header">
      <div class="brand">
        <div class="logo">MCQ</div>
        <div>
          <h1>MCQ Exam — Class 7-12</h1>
          <p>30 minute test • 20 questions • +1 / 0 / -0.5</p>
        </div>
      </div>
      <div class="timer" id="timerTop">⏳ 30:00</div>
    </div>

    <div class="grid">
      <!-- LEFT: Exam Area -->
      <div>
        <div class="card">
          <div class="meta">
            <div class="left muted">Student: <span id="studentNameDisplay">—</span></div>
            <div class="right">Class: <span id="classDisplay">—</span></div>
          </div>

          <div class="q-card" id="questionCard" aria-live="polite">
            <div class="q-top">
              <div class="q-no" id="qNo">প্রশ্ন 1 / 20</div>
              <div class="progress" title="progress"><i id="progBar" style="width:5%"></i></div>
            </div>

            <div class="q-text" id="qText">Start the test by selecting class & name, then press Start Test.</div>

            <div class="opts" id="optionsList">
              <!-- option buttons inserted here -->
            </div>

            <div class="navs">
              <div style="display:flex;gap:8px">
                <button class="btn ghost" id="prevBtn">← Back</button>
                <button class="btn skip" id="skipBtn">Skip</button>
              </div>
              <div style="display:flex;gap:8px">
                <button class="btn ghost" id="saveBtn">Save Answer</button>
                <button class="btn primary" id="nextBtn">Next →</button>
              </div>
            </div>

            <div style="margin-top:12px;color:var(--muted);font-size:0.92rem">
              Tip: কোন প্রশ্নটার উত্তর যদি নিশ্চিত না, সেটা Skip করো — Skip এ 0 মার্কস।
            </div>
          </div>

          <div style="margin-top:12px;display:flex;justify-content:flex-end;gap:8px">
            <button class="btn ghost" id="quitBtn">Quit</button>
            <button class="btn primary" id="submitBtn">Submit Test</button>
          </div>
        </div>

        <footer> • Make sure questions are filled before starting</footer>
      </div>

      <!-- RIGHT: Controls -->
      <div>
        <div class="card">
          <div class="side-title">Start / Controls</div>
          <div class="controls">
            <div class="input">
              <input id="studentName" type="text" placeholder="নাম লিখুন..." />
              <select id="classSelect" class="select-class" aria-label="Select class">
                <option value="">Select Class</option>
                <option value="7">Class 7</option>
                <option value="8">Class 8</option>
                <option value="9">Class 9</option>
                <option value="10">Class 10</option>
                <option value="11">Class 11</option>
                <option value="12">Class 12</option>
              </select>
            </div>

            <div style="display:flex;gap:8px">
              <button class="btn primary" id="startBtn">Start Test</button>
              <button class="btn ghost" id="resetBtn">Reset</button>
            </div>

            <div class="summary">
              <div class="stat"><div>Time left</div><div id="timeLeft">30:00</div></div>
              <div class="stat"><div>Attempted</div><div id="statAttempt">0</div></div>
              <div class="stat"><div>Correct</div><div id="statCorrect">0</div></div>
              <div class="stat"><div>Wrong</div><div id="statWrong">0</div></div>
              <div class="stat"><div>Score</div><div id="statScore">0</div></div>
            </div>

            <div class="final center" id="helpText">
              Test rules:মোট প্রশ্ন সংখ্যা 20,   সঠিক উত্তর দিলে+1,ভুল উত্তর দিলে −0.5 wrong, skip করলে 0.
              •বিজ্ঞান ও অংক একসাথে থাকবে•পরীক্ষার সময়সীমা ৩০ মিনিট•
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- result modal -->
  <div class="modal" id="resultModal">
    <div class="mcard">
      <h2>তোমার রেজাল্ট</h2>
      <p id="resultSummary">Calculating...</p>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:14px">
        <button class="btn ghost" id="closeModal">Close</button>
        <button class="btn primary" id="waSend">Send via WhatsApp</button>
      </div>
    </div>
  </div>

<script>
/* ====== CONFIG ====== */
const WHATSAPP_NUMBER = '91' + '7479284838'; // country code +91
const TOTAL_QUESTIONS = 20;
const TEST_DURATION_SECONDS = 30 * 60; // 30 minutes

/* ====== QUESTIONS: Edit here ======
  Structure: { q: "...", opt: ["A","B","C","D"], right: index (0..3) }
  Put 20 objects per class below (I added 3 sample Qs; fill rest or duplicate placeholders).
*/
const QUESTIONS_BY_CLASS = {
  7: [
    { q:"ভারতের জাতীয় পশু কোনটি?", opt:["শিয়াল","শিয়াল নয়","বাঘ","হরিণ"], right:2 },
    { q:"পৃথিবীর প্রাকৃতিক উপগ্রহ কোনটি?", opt:["সূর্য","চাঁদ","অজস্র","গ্রহ"], right:1 },
    { q:"100 সেন্টিমিটার = কত মিটার?", opt:["0.1 m","1 m","10 m","100 m"], right:1 },
    // placeholders to make total 20:
    ...Array.from({length: TOTAL_QUESTIONS-3}).map((_,i)=>({ q:`Class 7: প্রশ্ন নম্বর ${i+4}`, opt:["A","B","C","D"], right:0 }))
  ],
  8: Array.from({length: TOTAL_QUESTIONS}).map((_,i)=>({ q:`Class 8: প্রশ্ন নম্বর ${i+1}`, opt:["A","B","C","D"], right:0 })),
  9: Array.from({length: TOTAL_QUESTIONS}).map((_,i)=>({ q:`Class 9: প্রশ্ন নম্বর ${i+1}`, opt:["A","B","C","D"], right:0 })),
  10: Array.from({length: TOTAL_QUESTIONS}).map((_,i)=>({ q:`Class 10: প্রশ্ন নম্বর ${i+1}`, opt:["A","B","C","D"], right:0 })),
  11: Array.from({length: TOTAL_QUESTIONS}).map((_,i)=>({ q:`Class 11: প্রশ্ন নম্বর ${i+1}`, opt:["A","B","C","D"], right:0 })),
  12: Array.from({length: TOTAL_QUESTIONS}).map((_,i)=>({ q:`Class 12: প্রশ্ন নম্বর ${i+1}`, opt:["A","B","C","D"], right:0 })),
};
/* ====== END edit questions ====== */

/* ====== STATE ====== */
let state = {
  class: null,
  user: '',
  mcqs: [],
  answers: Array(TOTAL_QUESTIONS).fill(null),
  current: 0,
  left: TEST_DURATION_SECONDS,
  running: false,
  timerId: null
};

/* ====== DOM refs ====== */
const timerTop = document.getElementById('timerTop');
const timeLeftEl = document.getElementById('timeLeft');
const studentName = document.getElementById('studentName');
const studentNameDisplay = document.getElementById('studentNameDisplay');
const classSelect = document.getElementById('classSelect');
const classDisplay = document.getElementById('classDisplay');

const startBtn = document.getElementById('startBtn');
const resetBtn = document.getElementById('resetBtn');
const qNo = document.getElementById('qNo');
const qText = document.getElementById('qText');
const optionsList = document.getElementById('optionsList');
const progBar = document.getElementById('progBar');

const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const saveBtn = document.getElementById('saveBtn');
const skipBtn = document.getElementById('skipBtn');
const submitBtn = document.getElementById('submitBtn');
const quitBtn = document.getElementById('quitBtn');

const statAttempt = document.getElementById('statAttempt');
const statCorrect = document.getElementById('statCorrect');
const statWrong = document.getElementById('statWrong');
const statScore = document.getElementById('statScore');

const resultModal = document.getElementById('resultModal');
const resultSummary = document.getElementById('resultSummary');
const closeModal = document.getElementById('closeModal');
const waSend = document.getElementById('waSend');

/* ====== UTIL ====== */
function pad(n){return String(n).padStart(2,'0')}
function formatTime(sec){
  const m = Math.floor(sec/60), s = sec%60; return `${pad(m)}:${pad(s)}`;
}

/* ====== UI render ====== */
function renderQuestion(){
  const i = state.current;
  const mcq = state.mcqs[i];
  qNo.innerText = `প্রশ্ন ${i+1} / ${TOTAL_QUESTIONS}`;
  qText.innerText = mcq.q;
  progBar.style.width = `${Math.round(((i)/TOTAL_QUESTIONS)*100)}%`;
  // build options
  optionsList.innerHTML = '';
  mcq.opt.forEach((o, idx)=>{
    const btn = document.createElement('div');
    btn.className = 'opt' + (state.answers[i]===idx ? ' selected' : '');
    btn.innerText = o;
    btn.onclick = ()=> {
      state.answers[i] = idx;
      renderQuestion();
      updateStats();
    };
    optionsList.appendChild(btn);
  });
  studentNameDisplay.innerText = state.user || '—';
  classDisplay.innerText = state.class || '—';
}

function updateStats(){
  let attempted = 0, correct=0, wrong=0, score=0;
  state.mcqs.forEach((mcq, idx)=>{
    const a = state.answers[idx];
    if(a === null) return;
    attempted++;
    if(a === mcq.right){ correct++; score += 1; }
    else { wrong++; score -= 0.5; }
  });
  statAttempt.innerText = attempted;
  statCorrect.innerText = correct;
  statWrong.innerText = wrong;
  statScore.innerText = Math.round(score*100)/100;
}

/* ====== TIMER ====== */
function updateTimerUI(){
  timerTop.innerText = `⏳ ${formatTime(state.left)}`;
  timeLeftEl.innerText = formatTime(state.left);
}
function startTimer(){
  if(state.timerId) clearInterval(state.timerId);
  state.timerId = setInterval(()=>{
    if(!state.running) return;
    state.left--;
    updateTimerUI();
    if(state.left<=0){ finishExam(); }
  },1000);
}

/* ====== ACTIONS ====== */
startBtn.onclick = ()=>{
  const nameVal = studentName.value.trim();
  const cls = classSelect.value;
  if(!nameVal){ alert('অনুগ্রহ করে নাম লিখুন।'); return; }
  if(!cls){ alert('ক্লাস সিলেক্ট করুন।'); return; }
  // init state
  state.class = cls;
  state.user = nameVal;
  state.mcqs = (QUESTIONS_BY_CLASS[cls] || []).slice(0, TOTAL_QUESTIONS);
  // if questions less than required, fill placeholders
  while(state.mcqs.length < TOTAL_QUESTIONS){
    state.mcqs.push({ q:`সামনের প্রশ্ন ${state.mcqs.length+1}`, opt:["A","B","C","D"], right:0});
  }
  state.answers = Array(TOTAL_QUESTIONS).fill(null);
  state.current = 0;
  state.left = TEST_DURATION_SECONDS;
  state.running = true;
  studentName.disabled = true;
  classSelect.disabled = true;
  startBtn.disabled = true;
  resetBtn.disabled = false;
  updateTimerUI();
  renderQuestion();
  updateStats();
  startTimer();

  // privacy: cancel if visibility lost
  document.addEventListener('visibilitychange', visibilityHandler);
  window.onblur = ()=>{/* optional: do nothing or cancel */};
};

resetBtn.onclick = ()=>{
  if(confirm('Reset test? সব উত্তর মুছে যাবে।')) location.reload();
};

prevBtn.onclick = ()=>{ if(state.current>0){ state.current--; renderQuestion(); } };
nextBtn.onclick = ()=>{ if(state.current<TOTAL_QUESTIONS-1){ state.current++; renderQuestion(); } };

saveBtn.onclick = ()=>{ // just re-render (answer already set on click)
  renderQuestion(); updateStats();
};

skipBtn.onclick = ()=>{ state.answers[state.current] = null; if(state.current<TOTAL_QUESTIONS-1) state.current++; renderQuestion(); updateStats(); };

quitBtn.onclick = ()=>{ if(confirm('Quit and reset the test?')) location.reload(); };

submitBtn.onclick = ()=>{ if(!confirm('Are you sure to submit the test?')) return; finishExam(); };

/* ====== FINISH & RESULT ====== */
function finishExam(){
  state.running = false;
  clearInterval(state.timerId);
  document.removeEventListener('visibilitychange', visibilityHandler);
  // calculate
  let score=0, right=0, wrong=0, skip=0;
  state.mcqs.forEach((mcq,i)=>{
    const a = state.answers[i];
    if(a===null || a===undefined) skip++;
    else if(a === mcq.right){ score += 1; right++; }
    else { score -= 0.5; wrong++; }
  });
  score = Math.round(score*100)/100;
  // show modal
  resultSummary.innerHTML = `
    নাম: <strong>${escapeHtml(state.user)}</strong><br>
    ক্লাস: <strong>${escapeHtml(state.class)}</strong><br>
    Score: <strong>${score} / ${TOTAL_QUESTIONS}</strong><br>
    সঠিক: ${right}, ভুল: ${wrong}, স্কিপ: ${skip}
  `;
  resultModal.style.display = 'flex';

  // auto prepare WhatsApp message (but do not auto-open — user can click button)
  const waText = `MCQ Result (Class ${state.class})%0AName: ${encodeURIComponent(state.user)}%0AScore: ${score} / ${TOTAL_QUESTIONS}%0A✅: ${right}, ❌: ${wrong}, ⏭️: ${skip}`;
  waSend.onclick = ()=> {
    const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${waText}`;
    window.open(url,'_blank');
  };
}

/* helper: escape for display */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[m]); }

/* visibility handler: optional cancel if tab hidden */
function visibilityHandler(){
  if(document.visibilityState !== 'visible' && state.running){
    // optional: auto-pause or warn user
    // For now, we just show a console warning. You can enable cancelExam behaviour if needed.
    console.warn('Visibility lost — test still running in background.');
  }
}

/* close modal */
closeModal.onclick = ()=>{ resultModal.style.display = 'none'; };

/* keyboard shortcuts */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'ArrowRight') nextBtn.click();
  if(e.key === 'ArrowLeft') prevBtn.click();
});

/* init small UI */
updateTimerUI();
renderQuestion();
updateStats();

</script>
</body>
</html>